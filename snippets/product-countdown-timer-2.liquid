<style>
#countdown-timer-2 .wrap {
  
}

#countdown-timer-2 a {
  text-decoration: none;
  color: #1a1a1a;
}
.countdown-header {
    color: var(--countdown-header_text_color);
}
#countdown-timer-2 h1 {  
 /* margin-bottom: 60px; */
  text-align: center;
  font: 300 2.25em 'Lato';
  text-transform: uppercase;
  
}
#countdown-timer-2 h1 strong {
  font-weight: 400;
  color: #ea4c4c;
}  

#countdown-timer-2 h2 {
  margin-bottom: 80px;  
  text-align: center;  
  font: 300 0.7em 'Lato'; 
  text-transform: uppercase;
}
#countdown-timer-2 h2 strong {    
  font-weight: 400;   
}

#countdown-timer-2 .times{
    display: flex;
    justify-content: center;
}
#countdown-timer-2 .countdown .bloc-time {
 /* float: left;    
  margin-right: 45px;  */  
  text-align: center;
  padding: 0 5px;
}

#countdown-timer-2 .countdown .bloc-time:last-child {
  margin-right: 0;
}

#countdown-timer-2 .countdown .count-title {
  display: block;
  margin-bottom: 15px;
  font: normal var(--countdown-2-labels_fontsize) var(--countdown-2-labels_font);
  color: var(--countdown-2-labels_color);
  text-transform: uppercase;
}

#countdown-timer-2 .countdown .figure {
  position: relative;
  float: left;
  height: 50px;
  width: 50px;
  margin-right: 4px;
  background-color: var(--countdown-2-values_back_color);
  border-radius: 5px; 
  box-shadow: 0 3px 4px 0 rgba(0, 0, 0, .2), inset 2px 4px 0 0 rgba(255, 255, 255, .08);
}

#countdown-timer-2 .countdown .figure:last-child {
  margin-right: 0;
}

#countdown-timer-2 .countdown .figure > span {
  position: absolute;
  left: 0;
  right: 0;
  margin: auto;
  font: normal 44px var(--countdown-2-values_font);
  font-weight: 700;
  color: var(--countdown-2-values_color);
}

#countdown-timer-2 .countdown .figure  .top::after, #countdown-timer-2 .countdown .figure .bottom-back::after {
    content: "";
    position: absolute;
    z-index: -1;
    left: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    border-bottom: 1px solid rgba(0, 0, 0, .1);
}

#countdown-timer-2 .countdown .figure .top {
  z-index: 3;
  background-color: var(--countdown-2-values_back_color);
  transform-origin: 50% 100%;
  -webkit-transform-origin: 50% 100%; 
  border-top-left-radius: 5px; 
  border-top-right-radius: 5px; 
  transform: perspective(200px);
}

#countdown-timer-2 .countdown .figure .bottom {  
  z-index: 1;
  
}
#countdown-timer-2 .countdown .figure .bottom::before {
 content: "";
  position: absolute;
  display: block; 
  top: 0;
  left: 0;
  width: 100%;
  height: 50%;
  background-color: rgba(0, 0, 0, .02);
}

#countdown-timer-2 .countdown .figure .bottom-back {
  z-index: 2;
  top: 0;
  height: 50%;
  overflow: hidden;    
  background-color: var(--countdown-2-values_back_color);
  border-top-left-radius: 5px;
  border-top-right-radius: 5px; 
}

#countdown-timer-2 .countdown .figure .bottom-back span {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    margin: auto;
}
 
#countdown-timer-2 .top, #countdown-timer-2 .top-back {
  height: 50%;
  overflow: hidden;
  backface-visibility: hidden;
}

#countdown-timer-2 .top-back {
  z-index: 4;
  bottom: 0;
  background-color: var(--countdown-2-values_back_color);
  -webkit-transform-origin: 50% 0;
  transform-origin: 50% 0;
  transform: perspective(200px) rotateX(180deg);
  border-bottom-right-radius: 5px;
  border-bottom-left-radius: 5px;
}

#countdown-timer-2 .top-back span {
    position: absolute;
    top: -100%;
    left: 0;
    right: 0;
    margin: auto;
}
</style>

<div id='countdown-timer-2'>
    <div class="wrap">  
        <h3 class="countdown-header">{{ countdown_header_text }}</h3>
        <div class="countdown row">
            <div class="bloc-time days col-xs-3 col-sm-6 col-md-3" data-init-value="0">
                <span class="count-title">Days</span>
                <div class="times">
                    <div class="figure days days-1">
                        <span class="top">0</span>
                        <span class="top-back">
                            <span>0</span>
                        </span>
                        <span class="bottom">0</span>
                        <span class="bottom-back">
                            <span>0</span>
                        </span>
                    </div>

                    <div class="figure days days-2">
                        <span class="top">0</span>
                        <span class="top-back">
                            <span>0</span>
                        </span>
                        <span class="bottom">0</span>
                        <span class="bottom-back">
                            <span>0</span>
                        </span>
                    </div>
                </div>
            </div>
            
            <div class="bloc-time hours col-xs-3 col-sm-6 col-md-3" data-init-value="0">
                <span class="count-title">Hours</span>

                <div class="times">
                    <div class="figure hours hours-1">
                        <span class="top">0</span>
                        <span class="top-back">
                            <span>0</span>
                        </span>
                        <span class="bottom">0</span>
                        <span class="bottom-back">
                            <span>0</span>
                        </span>
                    </div>

                    <div class="figure hours hours-2">
                        <span class="top">0</span>
                        <span class="top-back">
                            <span>0</span>
                        </span>
                        <span class="bottom">0</span>
                        <span class="bottom-back">
                            <span>0</span>
                        </span>
                    </div>
                </div>
            </div>

            <div class="bloc-time min col-xs-3 col-sm-6 col-md-3" data-init-value="0">
                <span class="count-title">Minutes</span>

                <div class="times">
                    <div class="figure min min-1">
                        <span class="top">0</span>
                        <span class="top-back">
                            <span>0</span>
                        </span>
                        <span class="bottom">0</span>
                        <span class="bottom-back">
                            <span>0</span>
                        </span>        
                    </div>

                    <div class="figure min min-2">
                        <span class="top">0</span>
                        <span class="top-back">
                            <span>0</span>
                        </span>
                        <span class="bottom">0</span>
                        <span class="bottom-back">
                            <span>0</span>
                        </span>
                    </div>
                </div>
            </div>

            <div class="bloc-time sec  col-xs-3 col-sm-6 col-md-3" data-init-value="0">
                <span class="count-title">Seconds</span>

                <div class="times">
                    <div class="figure sec sec-1">
                        <span class="top">0</span>
                        <span class="top-back">
                            <span>0</span>
                        </span>
                        <span class="bottom">0</span>
                        <span class="bottom-back">
                            <span>0</span>
                        </span>          
                    </div>

                    <div class="figure sec sec-2">
                        <span class="top">0</span>
                        <span class="top-back">
                            <span>0</span>
                        </span>
                        <span class="bottom">0</span>
                        <span class="bottom-back">
                            <span>0</span>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{{ 'TweenMax.js' | asset_url | script_tag }}

<script>
    var expire = '{{ expire }}';
    var Countdown = {
        
        // Backbone-like structure
        $el: $('#countdown-timer-2'),
        
        // Params
        countdown_interval: null,
        total_seconds     : 0,
        
        // Initialize the countdown  
        init: function() {
        // DOM
            this.$ = {
                days  : this.$el.find('.bloc-time.days .figure'),
                hours  : this.$el.find('.bloc-time.hours .figure'),
                minutes: this.$el.find('.bloc-time.min .figure'),
                seconds: this.$el.find('.bloc-time.sec .figure')
            };

            // Initialize total seconds
            if(!localStorage.getItem('expire' + expire)){
                localStorage.setItem('expire' + expire, Date.parse(new Date()) + (1000 * 3600 * expire));
            }
            this.total_seconds = (new Date(parseInt(localStorage.getItem('expire' + expire))) - new Date()) / 1000;
            this.total_seconds = Math.trunc(this.total_seconds);
            
            // Init countdown values
            var day_remaining = this.total_seconds % (3600 * 24);
            var hour_remaining = day_remaining % 3600;
            var min_remaining = hour_remaining % 60;
            this.values = {
                days  : Math.floor( this.total_seconds / (3600 * 24)),
                hours  : Math.floor( day_remaining / 3600),
                minutes: Math.floor( hour_remaining / 60),
                seconds: Math.floor( min_remaining),
            };

            // Animate countdown to the end 
            this.count();
        },
        
        count: function() {
        
            var that    = this,
                $day_1 = this.$.days.eq(0),
                $day_2 = this.$.days.eq(1),
                $hour_1 = this.$.hours.eq(0),
                $hour_2 = this.$.hours.eq(1),
                $min_1  = this.$.minutes.eq(0),
                $min_2  = this.$.minutes.eq(1),
                $sec_1  = this.$.seconds.eq(0),
                $sec_2  = this.$.seconds.eq(1);
            
                this.countdown_interval = setInterval(function() {

                if(that.total_seconds > 0) {

                    --that.values.seconds;              

                    if(that.values.minutes >= 0 && that.values.seconds < 0) {

                        that.values.seconds = 59;
                        --that.values.minutes;
                    }

                    if(that.values.hours >= 0 && that.values.minutes < 0) {

                        that.values.minutes = 59;
                        --that.values.hours;
                    }

                    if(that.values.days > 0 && that.values.hours < 0) {

                        that.values.hours = 23;
                        --that.values.days;
                    }
                    // Update DOM values
                    // Days
                    that.checkHour(that.values.days, $day_1, $day_2);

                    // Hours
                    that.checkHour(that.values.hours, $hour_1, $hour_2);

                    // Minutes
                    that.checkHour(that.values.minutes, $min_1, $min_2);

                    // Seconds
                    that.checkHour(that.values.seconds, $sec_1, $sec_2);

                    --that.total_seconds;
                }
                else {
                    localStorage.setItem('expire' + expire, Date.parse(new Date()) + (1000 * 3600 * expire));
                }
            }, 1000);    
        },
        
        animateFigure: function($el, value) {
        
            var that         = this,
                $top         = $el.find('.top'),
                $bottom      = $el.find('.bottom'),
                $back_top    = $el.find('.top-back'),
                $back_bottom = $el.find('.bottom-back');

            // Before we begin, change the back value
            $back_top.find('span').html(value);

            // Also change the back bottom value
            $back_bottom.find('span').html(value);

            // Then animate
            TweenMax.to($top, 0.8, {
                rotationX           : '-180deg',
                transformPerspective: 300,
                ease                : Quart.easeOut,
                onComplete          : function() {

                    $top.html(value);

                    $bottom.html(value);

                    TweenMax.set($top, { rotationX: 0 });
                }
            });

            TweenMax.to($back_top, 0.8, { 
                rotationX           : 0,
                transformPerspective: 300,
                ease                : Quart.easeOut, 
                clearProps          : 'all' 
            });    
        },
        
        checkHour: function(value, $el_1, $el_2) {
        
            var val_1       = value.toString().charAt(0),
                val_2       = value.toString().charAt(1),
                fig_1_value = $el_1.find('.top').html(),
                fig_2_value = $el_2.find('.top').html();

            if(value >= 10) {

                // Animate only if the figure has changed
                if(fig_1_value !== val_1) this.animateFigure($el_1, val_1);
                if(fig_2_value !== val_2) this.animateFigure($el_2, val_2);
            }
            else {

                // If we are under 10, replace first figure with 0
                if(fig_1_value !== '0') this.animateFigure($el_1, 0);
                if(fig_2_value !== val_1) this.animateFigure($el_2, val_1);
            }    
        }
    };

    // Let's go !
    if(expire){
        Countdown.init();
    }
</script>